\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --logistic --ci 0.95 --reference-allele \\10.141.0.2\Kadoorie\weigan\DATASETS\risk.allele.code --pheno \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_CLEAN_Pheno.txt --pheno-name Pheno --covar \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_CLEAN_Pheno.txt --hide-covar --sex --covar-name age,region,PC1 --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\singlesnp\clean_t2d_add
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --reference-allele \\10.141.0.2\Kadoorie\weigan\DATASETS\risk.allele.code --keep \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_CLEAN_Pheno.txt --freq --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\singlesnp\clean_t2d_freq
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --keep \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_CLEAN_Pheno.txt --extract \\10.141.0.2\Kadoorie\weigan\T2D_GRS\grssnps.txt --set-hh-missing --recodeA --recode-allele \\10.141.0.2\Kadoorie\weigan\DATASETS\risk.allele.code --out  \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\add_clean_grs
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --keep \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_CLEAN_Pheno.txt --extract \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\meta_clean.txt --set-hh-missing --recodeA --recode-allele \\10.141.0.2\Kadoorie\weigan\DATASETS\risk.allele.code --out  \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\add_clean


#\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --logistic --ci 0.95 --reference-allele \\10.141.0.2\Kadoorie\weigan\DATASETS\risk.allele.code --pheno \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_CLEAN_Pheno.txt --pheno-name Pheno --covar \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_CLEAN_Pheno.txt --hide-covar --sex --covar-name age,region --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\singlesnp\clean_t2d_add_nopc
#af by region
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --freq --within \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-clusters \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-cluster-names 12 --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\freq_12 
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --freq --within \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-clusters \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-cluster-names 16 --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\freq_16 
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --freq --within \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-clusters \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-cluster-names 26 --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\freq_26 
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --freq --within \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-clusters \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-cluster-names 36 --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\freq_36 
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --freq --within \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-clusters \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-cluster-names 46 --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\freq_46 
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --freq --within \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-clusters \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-cluster-names 52 --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\freq_52 
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --freq --within \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-clusters \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-cluster-names 58 --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\freq_58 
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --freq --within \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-clusters \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-cluster-names 68 --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\freq_68 
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --freq --within \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-clusters \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-cluster-names 78 --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\freq_78 
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\DATASETS\CKB_Clean_new_id_t2d_forward --freq --within \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-clusters \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_plink_region.txt --keep-cluster-names 88 --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\freq_88 


a=read.table('//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/add_clean.raw',sep=' ',header=T)
names(a)[]=sapply(strsplit(names(a)[],'_',1),'[',1)
write.csv(a,'//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/add_clean.csv',row.names=F,quote=F,na='.')

\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\T2D_GRS\CKB_Clean_unrelated_t2d --logistic --ci 0.95 --reference-allele \\10.141.0.2\Kadoorie\weigan\DATASETS\risk.allele.code --pheno \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_UNRELATED_Pheno.txt --pheno-name Pheno --covar \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\CKB_UNRELATED_Pheno.txt --hide-covar --sex --covar-name age,region,PC1 --out \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\singlesnp\unrelated_t2d_add
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\T2D_GRS\CKB_Clean_unrelated_t2d --extract \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\meta_clean.txt --set-hh-missing --recodeA --recode-allele \\10.141.0.2\Kadoorie\weigan\DATASETS\risk.allele.code --out  \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\add_unrealated
\\10.141.0.2\Kadoorie\weigan\T2D_GRS\plink --bfile \\10.141.0.2\Kadoorie\weigan\T2D_GRS\CKB_Clean_unrelated_t2d --extract \\10.141.0.2\Kadoorie\weigan\T2D_GRS\grssnps.txt --set-hh-missing --recodeA --recode-allele \\10.141.0.2\Kadoorie\weigan\DATASETS\risk.allele.code --out  \\10.141.0.2\Kadoorie\weigan\T2D_REPLICATION\add_unrealated_grs
a=read.table('//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/add_unrealated.raw',sep=' ',header=T)
names(a)[]=sapply(strsplit(names(a)[],'_',1),'[',1)
write.csv(a,'//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/add_unrealated.csv',row.names=F,quote=F,na='.')


#####
# GRS
#####
t2d_geno=read.table('//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/add_clean_grs.raw',header=T)
names(t2d_geno)[]=sapply(strsplit(names(t2d_geno)[],'_',1),'[',1)
region=read.table('//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/CKB_plink_region.txt',header=T)
names(region)=c('FID','IID','region')
raw=merge(region,t2d_geno,by=c('FID','IID'))
freq_by_region=read.table('//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/freq_by_region',header=T)
weight=read.table('//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/weights.txt',header=T)
regionlist=c(12,16,26,36,46,52,58,68,78,88)
impute=as.data.frame(array(NA,dim=c(93131,60)))
names(impute)[]=names(raw)
impute[,1:7]=raw[,1:7]
for (i in 1:10){
        for (j in 8:60){
                impute[impute$region==regionlist[i],j]=ifelse(is.na(raw[ raw$region==regionlist[i],j]),
                                                              freq_by_region[ freq_by_region$CLST==regionlist[i] & freq_by_region$SNP==names(raw)[j],'MAF']*2,
                                                              round(raw[ raw$region==regionlist[i],j],0))
                j=j+1
        }
        i=i+1
}
beta=c("rs340874", "rs7578597", "rs11708067", "rs1470579", "rs16861329", "rs6815464", "rs7754840", "rs4607517", "rs6467136", "rs7041847", "rs10811661", "rs1111875", "rs7901695", "rs2237892", "rs5215", "rs1552224", "rs10830963", "rs1359790", "rs7172432", "rs2028299", "rs4430796", "rs6017317", "rs13266634", "rs8042680", "rs2191349")
ir=c("rs780094", "rs3923113", "rs2943641", "rs1801282", "rs972283", "rs1531343")
impute$grst=rowSums(impute[,8:60])
impute$grsb=rowSums(impute[,beta])
impute$grsir=rowSums(impute[,ir])
summary(impute$grst)
summary(impute$grsb)
summary(impute$grsir)

raw$grst=rowSums(raw[,8:60])
raw$grsb=rowSums(raw[,beta])
raw$grsir=rowSums(raw[,ir])
summary(raw$grst)
summary(raw$grsb)
summary(raw$grsir)
raw$na=apply(raw[,8:60],1,function(x) sum(as.numeric(is.na(x))))

grs_w=function(x){
        impute_w=as.data.frame(array(NA,dim=c(93131,63)))
        names(impute_w)[]=names(impute)
        impute_w[,c(1:7,61:63)]=impute[,c(1:7,61:63)]
        for (j in 8:60){
                impute_w[,j]=  weight[weight$SNP==names(impute)[j],x]*impute[,j]
                j=j+1
                
        }
        impute_w[,paste('grst',names(weight)[x],sep='_')]=rowSums(impute_w[,8:60])
        impute_w[,paste('grsb',names(weight)[x],sep='_')]=rowSums(impute_w[,beta])
        impute_w[,paste('grsir',names(weight)[x],sep='_')]=rowSums(impute_w[,ir])
        grsw=impute_w[,c(1:2,64:66)]
        grsw
}
grs_gwas=grs_w(x=2)
grs_meta=grs_w(x=3)
grs_agen=grs_w(x=4)
grs_acc=impute[,c(1:2,61:63)]
grsc=cbind(grs_agen,grs_gwas,grs_meta,grs_acc)
grsc=grsc[,c(1:5,8:10,13:15,18:20)]

write.csv(grsc,'//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/grs_score_clean.csv',row.names=F,quote=F,na='.')

########################
# association analysis
########################
phe=read.table('//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/CKB_CLEAN_Pheno.txt',header=T)
phe$T2D=ifelse(phe$Pheno==1,0,ifelse(phe$Pheno==2,1,NA))
grs=merge(phe,grsc,by=c('FID','IID'))
grs=grs[,c(1:8,9,12,15,18,10,13,16,19,11,14,17,20)]
t2d_free=read.table('//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/t2d_free.txt',header=T)
grs_t2dfree=merge(t2d_free,grsc,by=c('FID','IID'))
for (i in 3:14){
        grs_t2dfree[,paste(names(grs_t2dfree)[i],'q',sep='_')]=cut(grs_t2dfree[,i],quantile(grs_t2dfree[,i],c(0,0.333,0.666,1),na.rm=T),include.lowest=TRUE)
        levels(grs_t2dfree[,paste(names(grs_t2dfree)[i],'q',sep='_')])=seq(1,3,1)
        i=i+1
}
write.csv(grs_t2dfree,'//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/grs_score_clean_t2dfree.csv',row.names=F,quote=F,na='.')

#quantile
for (i in 9:12){
        grs[,paste(names(grs)[i],'q',sep='_')]=cut(grs[,i],quantile(grs[,i],seq(0,1,0.1),na.rm=T),include.lowest=TRUE)
        levels(grs[,paste(names(grs)[i],'q',sep='_')])=seq(1,10,1)
        i=i+1
}
for (i in 13:16){
        grs[,paste(names(grs)[i],'q',sep='_')]=cut(grs[,i],quantile(grs[,i],seq(0,1,0.125),na.rm=T),include.lowest=TRUE)
        levels(grs[,paste(names(grs)[i],'q',sep='_')])=seq(1,8,1)
        i=i+1
}
for (i in 17:20){
        grs[,paste(names(grs)[i],'q',sep='_')]=cut(grs[,i],quantile(grs[,i],seq(0,1,0.25),na.rm=T),include.lowest=TRUE)
        levels(grs[,paste(names(grs)[i],'q',sep='_')])=seq(1,4,1)
        i=i+1
}

grsglm<-function(dataset,disease){
        
        results=array(NA,dim=c(24,7))
        for (i in 9:17){
                gl<-summary(glm(dataset[,disease] ~scale(dataset[,i]) + 
                                        dataset[,'sex'] + dataset[,'age'] + 
                                        dataset[,'region'], family=binomial))
                results[i-8,]=c(names(dataset)[i],round(gl$coefficients[2,1:2],4),
                                round(exp(gl$coefficients[2,1]+0),4), 
                                round(exp(gl$coefficients[2,1]-gl$coefficients[2,2]*1.96),4),
                                round(exp(gl$coefficients[2,1]+gl$coefficients[2,2]*1.96),4),
                                gl$coefficients[2,4])
                i=i+1
        }
        for (i in 18:32){
                gl<-summary(glm(dataset[,disease] ~as.numeric(dataset[,i]) + 
                                        dataset[,'sex'] + dataset[,'age'] + 
                                        dataset[,'region'], family=binomial))
                results[i-8,]=c(names(dataset)[i],round(gl$coefficients[2,1:2],4),
                                round(exp(gl$coefficients[2,1]+0),4), 
                                round(exp(gl$coefficients[2,1]-gl$coefficients[2,2]*1.96),4),
                                round(exp(gl$coefficients[2,1]+gl$coefficients[2,2]*1.96),4),
                                gl$coefficients[2,4])
                i=i+1
        }
        results=as.data.frame(results)
        colnames(results)[]=c('GRS','Beta','Std.Error','OR','95%CI_LOW','95%CI_UP','P')
        write.csv(results,paste('//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/',c(disease),'_association_nopc.csv',sep=''),row.names=F,quote=F)
}

grsglm(dataset = grs,disease = 'T2D')

grsglm_group<-function(dataset,disease){
        
        results=array(NA,dim=c(36,7))
        for (i in 21:32){
                gl<-summary(glm(dataset[,disease] ~dataset[,i] + 
                                        dataset[,'sex'] + dataset[,'age'] + 
                                        dataset[,'region'], family=binomial))
                
                results[c(3*i-62),]=c(names(dataset)[i],round(gl$coefficients[2,1:2],4),
                                      round(exp(gl$coefficients[2,1]+0),4), 
                                      round(exp(gl$coefficients[2,1]-gl$coefficients[2,2]*1.96),4),
                                      round(exp(gl$coefficients[2,1]+gl$coefficients[2,2]*1.96),4),
                                      gl$coefficients[2,4])
                results[c(3*i-61),]=c(names(dataset)[i],round(gl$coefficients[3,1:2],4),
                                      round(exp(gl$coefficients[3,1]+0),4), 
                                      round(exp(gl$coefficients[3,1]-gl$coefficients[3,2]*1.96),4),
                                      round(exp(gl$coefficients[3,1]+gl$coefficients[3,2]*1.96),4),
                                      gl$coefficients[3,4])
                results[c(3*i-60),]=c(names(dataset)[i],round(gl$coefficients[4,1:2],4),
                                      round(exp(gl$coefficients[4,1]+0),4), 
                                      round(exp(gl$coefficients[4,1]-gl$coefficients[4,2]*1.96),4),
                                      round(exp(gl$coefficients[4,1]+gl$coefficients[4,2]*1.96),4),
                                      gl$coefficients[4,4])
                i=i+1
                
        }
        results=as.data.frame(results)
        colnames(results)[]=c('GRS','Beta','Std.Error','OR','95%CI_LOW','95%CI_UP','P')
        write.csv(results,paste('//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/','Group',c(disease),'_association.csv',sep=''),row.names=F,quote=F)
}

grsglm_group(dataset = grs,disease = 'T2D')

grsglm_group_ir<-function(dataset,disease){
        
        results=as.data.frame(array(NA,dim=c(12,7)))
        for (i in 29:32){
                gl<-summary(glm(dataset[,disease] ~dataset[,i] + 
                                        dataset[,'sex'] + dataset[,'age'] + 
                                        dataset[,'region'], family=binomial))
                
                results[(3*i-86):c(3*i-84),2:7]=as.data.frame(cbind(gl$coefficients[2:4,c(1,2,4)],exp(gl$coefficients[2:4,1]),exp(gl$coefficients[2:4,1]-gl$coefficients[2:4,2]*1.96),exp(gl$coefficients[2:4,1]+gl$coefficients[2:4,2]*1.96)))[1:3,1:6]
                results[(3*i-86):c(3*i-84),1]=c(paste(names(grs)[i],seq(2,4,1),sep="_"))
                i=i+1
                
        }
        colnames(results)[]=c('GRS','Beta','Std.Error','P','OR','95%CI_LOW','95%CI_UP')
        write.csv(results,paste('//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/','IR_Group',c(disease),'_association.csv',sep=''),row.names=F,quote=F)
}
grsglm_group_ir(dataset = grs,disease = 'T2D')

grsglm_group_b<-function(dataset,disease){
        
        results=as.data.frame(array(NA,dim=c(28,7)))
        for (i in 25:28){
                gl<-summary(glm(dataset[,disease] ~dataset[,i] + 
                                        dataset[,'sex'] + dataset[,'age'] + 
                                        dataset[,'region'], family=binomial))
                
                results[(7*i-174):c(7*i-168),2:7]=as.data.frame(cbind(gl$coefficients[2:8,c(1,2,4)],exp(gl$coefficients[2:8,1]),exp(gl$coefficients[2:8,1]-gl$coefficients[2:8,2]*1.96),exp(gl$coefficients[2:8,1]+gl$coefficients[2:8,2]*1.96)))[1:7,1:6]
                results[(7*i-174):c(7*i-168),1]=c(paste(names(grs)[i],seq(2,8,1),sep="_"))
                i=i+1
                
        }
        colnames(results)[]=c('GRS','Beta','Std.Error','P','OR','95%CI_LOW','95%CI_UP')
        write.csv(results,paste('//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/','b_Group',c(disease),'_association.csv',sep=''),row.names=F,quote=F)
}
grsglm_group_b(dataset = grs,disease = 'T2D')

grsglm_group_t<-function(dataset,disease){
        
        results=as.data.frame(array(NA,dim=c(36,7)))
        for (i in 21:24){
                gl<-summary(glm(dataset[,disease] ~dataset[,i] + 
                                        dataset[,'sex'] + dataset[,'age'] + 
                                        dataset[,'region'], family=binomial))
                
                results[(9*i-188):c(9*i-180),2:7]=as.data.frame(cbind(gl$coefficients[2:10,c(1,2,4)],exp(gl$coefficients[2:10,1]),exp(gl$coefficients[2:10,1]-gl$coefficients[2:10,2]*1.96),exp(gl$coefficients[2:10,1]+gl$coefficients[2:10,2]*1.96)))[1:9,1:6]
                results[(9*i-188):c(9*i-180),1]=c(paste(names(grs)[i],seq(2,10,1),sep="_"))
                i=i+1
                
        }
        colnames(results)[]=c('GRS','Beta','Std.Error','P','OR','95%CI_LOW','95%CI_UP')
        write.csv(results,paste('//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/','t53_Group',c(disease),'_association.csv',sep=''),row.names=F,quote=F)
}
grsglm_group_t(dataset = grs,disease = 'T2D')


#plot distribution of GRS and the ORs
#grst53
pdf(file='//10.141.0.2/Kadoorie/weigan/T2D_REPLICATION/Distribution of unweighted gene score and odds ratios for association with T2D.pdf',width =12,height =9)
par(mfrow = c(2,2),new=F,mar = c(6,6,4,6))
        #t53 <- read.table(file = "clipboard", sep = "\t", header=F)
        
        #t53$grs=c(tapply(grs$grst,grs$grst_q,mean))
#par(mgp=c(4,0.5,0))
hist(grs$grst,breaks=50,ylim=c(0,9000),ylab=NULL,xlab = NULL,bty='n',yaxt='n',xaxt='n',border = 'darkgrey',col='grey', las = 2,main = 'A',adj=0)
axis(side = 2, at = c(seq(0,9000,3000)),labels=c(0,"3,000","6,000","9,000"),line=0,las=2,font.lab=2)
axis(side = 1, at = c(36,42,48,54,60,66,73),labels=c(36,42,48,54,60,66,73),las=1,cex=0.5,font.lab=2)
par(new=T)
plot(t53$grs,t53$V4,xlim = c(min(grs$grst),max(grs$grst)),ylim=c(0,9000),yaxt="n",xaxt="n",ylab='',xlab ='',pch=18,bty='n',cex.lab=1.2,font.lab=2)
arrows(t53[2:10,]$grs,t53[2:10,]$V5,t53[2:10,]$grs,t53[2:10,]$V6,length=0.05, angle=90, code=3,col='black',lty = 1,lwd=1)
axis(4,at=c(0,1000,3000,5000,7000,9000),labels=c('','1.0','1.5','2.0','2.5','3.0'),line=0,font.lab=2)
#text(t53$grs,t53$V4,label=round(t53$V1,2),pos = 4,cex=0.5)
mtext("Odds Ratio", side=4, line=2.5,cex = 1,las=0,font = 2)
mtext("GRS-t53", side=1, line=3,cex = 1,las=0,font = 2)
mtext("Number of individuals", side=2, line=3.5,cex = 1,las=0,font = 2)
mylabel=bquote(paste(italic(P),' for trend = 6.8×10') ^'-94')
text(x=43,y=9000,labels=mylabel,cex=1)
###BETA

        #orbeta <- read.table(file = "clipboard", sep = "\t", header=F)
        #orbeta$grs=c(tapply(grs$grsb,grs$grsb_q,mean))
hist(grs$grsb,breaks=20,ylim=c(0,12500),ylab=NULL,xlab = NULL,bty='n',yaxt='n',xaxt='n',main='B',border = 'darkgrey',col='grey', las = 2,adj=0)
axis(side = 2, at = c(seq(0,15000,4000)),labels=c(0,"4,000","8,000","12,000"),line=0,las=2)
axis(side = 1, at = c(14,20,25,30,35,40),labels=c(14,20,25,30,35,40),las=1,cex=0.5)
par(new=T)
plot(orbeta$grs,orbeta$V4,xlim = c(min(grs$grsb),max(grs$grsb)),ylim=c(0,12500),yaxt="n",xaxt="n",ylab='',xlab ='',pch=18,bty='n',cex.lab=1.2,font.lab=2)
arrows(orbeta[2:8,]$grs,orbeta[2:8,]$V5,orbeta[2:8,]$grs,orbeta[2:8,]$V6,length=0.05, angle=90, code=3,col='black',lty = 1,lwd=1)
axis(4,at=c(0,seq(2000,12000,3000),12000),labels=c('','1.0','1.5','2.0','2.5',''),line=0,font.lab=2)
#text(orbeta$grs,orbeta$V4,label=round(orbeta$V1,2),pos = 4,cex=0.5)
mtext("Odds Ratio", side=4, line=2.5,las=0,cex=1,font = 2)
mtext("GRS-BC", side=1, line=3,cex = 1,las=0,font = 2)
mtext("Number of individuals", side=2, line=3.5,cex = 1,las=0,font = 2)
mylabel=bquote(paste(italic(P),' for trend = 3.9×10') ^'-89')
text(x=19,y=12000,labels=mylabel,cex=1)
#IR
        
        #ir <- read.table(file = "clipboard", sep = "\t", header=F)
        
        #ir$grs=c(tapply(grs$grsir,grs$grsir_q,mean))
hist(grs$grsir,breaks=10,ylim=c(0,30000),ylab=NULL,xlab = NULL,bty='n',yaxt='n',xaxt='n',main='C',border = 'darkgrey',col='grey', las = 2,adj=0)
axis(side = 2, at = c(seq(0,30000,10000)),labels=c(0,"10,000","20,000","30,000"),line=-0.5,las=2)
axis(side = 1, at = seq(2,12,2),labels=seq(2,12,2),las=1,cex=0.5)
par(new=T)
plot(ir$grs,ir$V4,xlim = c(min(grs$grsir),max(grs$grsir)),ylim=c(0,30000),yaxt="n",xaxt="n",ylab="",xlab = '',pch=18,bty='n',cex.lab=1.2,font.lab=2)
arrows(ir[2:4,]$grs,ir[2:4,]$V5,ir[2:4,]$grs,ir[2:4,]$V6,length=0.05, angle=90, code=3,col='black',lty = 1,lwd=1)
axis(4,at=c(0,seq(10000,30000,8000),30000),labels=c('','1.0','1.2','1.4',''),line=-0.5,font.lab=2)
#text(ir$grs,ir$V4,label=round(ir$V1,2),pos = 4,cex=0.5)
mtext("Odds Ratio", side=4, line=2,las=0,cex=1,font = 2)
mtext("GRS-IR", side=1, line=3,cex = 1,las=0,font = 2)
mtext("Number of individuals", side=2, line=3.5,cex = 1,las=0,font = 2)
mylabel=bquote(paste(italic(P),' for trend = 2.9×10') ^'-6')
text(x=4,y=30000,labels=mylabel,cex=1)


#incidence <- read.table(file = "clipboard", sep = "\t", header=F)
incidence$P=2*(pnorm(incidence$V10/incidence$V11,lower.tail = F))
plot(incidence$V3,incidence$V8,pch=18,yaxt="n",xaxt="n",ylab="",xlab = '',cex.lab=1.2,font.lab=2,bty='n',xlim=c(-0.1,2.5),ylim=c(0,12.5),cex=1,main='D',adj=0)
arrows(incidence$V3,incidence$V8,incidence$V4,incidence$V8,length=0.05, angle=90, code=3,col='black',lty = 1,lwd=1.2)
arrows(incidence$V3,incidence$V8,incidence$V5,incidence$V8,length=0.05, angle=90, code=3,col='black',lty = 1,lwd=1.2)
arrows(1,-1,1,12.2,length=0.05, angle=90, code=0)
axis(side = 1, at = c(-0.1,0,0.5,1.0,1.5,2.0,2.5),labels=c('','0.0',0.5,'1.0',1.5,'2.0','2.5'),las=1,cex=0.5)
text(x=-0.1,y=12.5,labels='Score',cex=0.8,font = 2)
text(x=0.15,y=12.5,labels='Group',cex=0.8,font = 2)
text(x=0.63,y=12.5,labels='Events/Subcohort',cex=0.8,font = 2)
text(x=1.95,y=12.5,labels='HR [95%CI]',cex=0.8,font = 2)
text(x=2.4,y=12.5,labels='P-value',cex=0.8,font = 2)
text(x=-0.05,y=11.5,labels='GRS-t53',cex=0.7,font = 2)
text(x=-0.05,y=8,labels='GRS-BC',cex=0.7,font = 2)
text(x=-0.05,y=4,labels='GRS-IR',cex=0.7,font = 2)
text(x=0.15,y=incidence$V8,labels=incidence$V9,cex=0.7 )
text(x=0.62,y=incidence$V8,labels=incidence$V7,cex=0.7)
text(x=1.95,y=incidence$V8,labels=incidence$V6,cex=0.7 )

text(x=2.4,y=incidence$V8[c(-1,-4,-7)],labels=expression('2.9×10'^-5,'7.5×10'^-20,'0.49',
                                             '0.01','1.5×10'^-7,'2.1×10'^-26),cex=0.7,font = 2)

mtext("Hazard Ratio", side=1, line=3,cex = 1,las=0,font = 2)
dev.off()
